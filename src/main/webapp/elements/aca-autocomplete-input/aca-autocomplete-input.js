'use strict';

(function () {
  'use strict';

  Polymer({
    is: 'aca-autocomplete-input',

    properties: {

      _paperInput: {
        type: Object,
        value: undefined
      },

      selected: {
        type: Array,
        value: [],
        notify: true
      },

      available: {
        type: Array,
        value: function value() {
          return _.map(_.range(0, 200), function (x) {
            return {
              id: x,
              label: '' + x
            };
          });
        }
      },

      db: {
        type: String,
        value: undefined
      },

      selectionListener: {
        type: Object,
        value: undefined
      },

      minExpand: {
        type: Number,
        value: 1
      }
    },

    attached: function attached() {
      var inputItem = this.$.container.querySelector('paper-input');

      if (!_.isUndefined(inputItem)) {
        this._paperInput = inputItem;
        this.listen(this._paperInput, 'keyup', 'onInputChange');
      }
    },

    addToSelection: function addToSelection(newItem) {
      console.trace('adding to selection(for=%s): %s, %o', this.for, newItem.label, this.selected);
      this.push('selected', newItem);
      this._paperInput.value = '';

      if (!_.isUndefined(this.selectionListener)) {
        console.log('calling onSelect:', this.selectionListener);
        this.selectionListener.onSelect(newItem);
      }
    },

    removeFromSelection: function removeFromSelection(itemToRemove) {

      console.info('removing %s from %o', itemToRemove.label, _.map(this.selected, 'label'));

      var idx = _.indexOf(this.selected, itemToRemove);
      console.info('removing item at idx: ', idx);
      if (_.gt(idx, -1)) {
        console.info('removed item from list: ', this.splice('selected', idx, 1));
      } else {
        console.warn('item %o not found in list %o', itemToRemove, this.selected);
      }
    },

    onInputChange: function onInputChange(event) {
      if (!_.isUndefined(event.target)) {
        var val = _.toLower(event.target.value);
        var min = this.minExpand;

        var inputLengthGTE = function inputLengthGTE(input, min, debug) {
          var toReturn = _.gte(_.size(input), min);
          if (debug) {
            console.trace('_.gte(_.size(%s), %s): %s', input, min, toReturn);
          }
          return toReturn;
        };

        var isCtrlSpace = function isCtrlSpace(e) {
          var KEY_CODE_SPACE = 32;
          return e.ctrlKey && _.isEqual(e.keyCode, KEY_CODE_SPACE);
        };

        var filteredItems = function filteredItems(collection, filter) {
          return _.filter(collection, function (x) {
            return _.includes(_.toLower(x.label), filter);
            //return _.startsWith(_.toLower(x.label), filter);
          });
        };

        if (inputLengthGTE(val, min)) {
          var collection = _.uniqBy(app.db[this.db], 'label');
          this.$.acdropdown.items = filteredItems(collection, val);
        } else if (isCtrlSpace(event)) {
          this.$.acdropdown.items = _.sortBy(_.uniqBy(app.db[this.db], 'label'), 'label');
        } else {
          //this.$.acoverlay.items = [];
          console.warn('input value less than %s chars', min);
        }
      } else {
        console.warn('not responding to input');
      }
    },

    addAutocompleteItem: function addAutocompleteItem(e) {
      if (_.isEqual(this.for, e.detail.for)) {
        console.trace('iron-signal: request to add item: ', e);
        this.addToSelection(e.detail.item);
      }
    },

    removeAutocompleteItem: function removeAutocompleteItem(e) {
      if (_.isEqual(this.for, e.detail.for)) {
        console.trace('iron-signal: request to remove item: ', e);
        this.removeFromSelection(e.detail.item);
      }
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVsZW1lbnRzL2FjYS1hdXRvY29tcGxldGUtaW5wdXQvYWNhLWF1dG9jb21wbGV0ZS1pbnB1dC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLENBQUMsWUFBVztBQUNOOztBQUVBLFVBQVE7QUFDTixRQUFJLHdCQURFOztBQUdOLGdCQUFZOztBQUVWLG1CQUFhO0FBQ1gsY0FBTSxNQURLO0FBRVgsZUFBTztBQUZJLE9BRkg7O0FBT1YsZ0JBQVU7QUFDUixjQUFNLEtBREU7QUFFUixlQUFPLEVBRkM7QUFHUixnQkFBUTtBQUhBLE9BUEE7O0FBYVYsaUJBQVc7QUFDVCxjQUFNLEtBREc7QUFFVCxlQUFPLGlCQUFXO0FBQ2hCLGlCQUFPLEVBQUUsR0FBRixDQUFNLEVBQUUsS0FBRixDQUFRLENBQVIsRUFBVyxHQUFYLENBQU4sRUFBdUIsVUFBUyxDQUFULEVBQVk7QUFDeEMsbUJBQU87QUFDTCxrQkFBSSxDQURDO0FBRUwscUJBQU8sS0FBSztBQUZQLGFBQVA7QUFJRCxXQUxNLENBQVA7QUFNRDtBQVRRLE9BYkQ7O0FBeUJWLFVBQUk7QUFDRixjQUFNLE1BREo7QUFFRixlQUFPO0FBRkwsT0F6Qk07O0FBOEJWLHlCQUFtQjtBQUNqQixjQUFNLE1BRFc7QUFFakIsZUFBTztBQUZVLE9BOUJUOztBQW1DVixpQkFBVztBQUNULGNBQU0sTUFERztBQUVULGVBQU87QUFGRTtBQW5DRCxLQUhOOztBQTRDTixjQUFVLG9CQUFXO0FBQ25CLFVBQUksWUFBWSxLQUFLLENBQUwsQ0FBTyxTQUFQLENBQWlCLGFBQWpCLENBQStCLGFBQS9CLENBQWhCOztBQUVBLFVBQUksQ0FBQyxFQUFFLFdBQUYsQ0FBYyxTQUFkLENBQUwsRUFBK0I7QUFDN0IsYUFBSyxXQUFMLEdBQW1CLFNBQW5CO0FBQ0EsYUFBSyxNQUFMLENBQVksS0FBSyxXQUFqQixFQUE4QixPQUE5QixFQUF1QyxlQUF2QztBQUNEO0FBQ0YsS0FuREs7O0FBcUROLG9CQUFnQix3QkFBUyxPQUFULEVB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QVAsQ0FBa0IsS0FBbEIsR0FBMEIsRUFBRSxNQUFGLENBQVMsRUFBRSxNQUFGLENBQVMsSUFBSSxFQUFKLENBQU8sS0FBSyxFQUFaLENBQVQsRUFBMEIsT0FBMUIsQ0FBVCxFQUE2QyxPQUE3QyxDQUExQjtBQUNELFNBRk0sTUFFQTtBQUNMO0FBQ0Esa0JBQVEsSUFBUixDQUFhLGdDQUFiLEVBQStDLEdBQS9DO0FBQ0Q7QUFDRixPQWpDRCxNQWlDTztBQUFFLGdCQUFRLElBQVIsQ0FBYSx5QkFBYjtBQUEwQztBQUNwRCxLQWpISzs7QUFtSE4seUJBQXFCLDZCQUFTLENBQVQsRUFBWTtBQUMvQixVQUFJLEVBQUUsT0FBRixDQUFVLEtBQUssR0FBZixFQUFvQixFQUFFLE1BQUYsQ0FBUyxHQUE3QixDQUFKLEVBQXVDO0FBQ3JDLGdCQUFRLEtBQVIsQ0FBYyxvQ0FBZCxFQUFvRCxDQUFwRDtBQUNBLGFBQUssY0FBTCxDQUFvQixFQUFFLE1BQUYsQ0FBUyxJQUE3QjtBQUNEO0FBQ0YsS0F4SEs7O0FBMEhOLDRCQUF3QixnQ0FBUyxDQUFULEVBQVk7QUFDbEMsVUFBSSxFQUFFLE9BQUYsQ0FBVSxLQUFLLEdBQWYsRUFBb0IsRUFBRSxNQUFGLENBQVMsR0FBN0IsQ0FBSixFQUF1QztBQUNyQyxnQkFBUSxLQUFSLENBQWMsdUNBQWQsRUFBdUQsQ0FBdkQ7QUFDQSxhQUFLLG1CQUFMLENBQXlCLEVBQUUsTUFBRixDQUFTLElBQWxDO0FBQ0Q7QUFDRjtBQS9ISyxHQUFSO0FBaUlELENBcElMIiwiZmlsZSI6ImVsZW1lbnRzL2FjYS1hdXRvY29tcGxldGUtaW5wdXQvYWNhLWF1dG9jb21wbGV0ZS1pbnB1dC5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgICAgICd1c2Ugc3RyaWN0JztcblxuICAgICAgUG9seW1lcih7XG4gICAgICAgIGlzOiAnYWNhLWF1dG9jb21wbGV0ZS1pbnB1dCcsXG5cbiAgICAgICAgcHJvcGVydGllczoge1xuXG4gICAgICAgICAgX3BhcGVySW5wdXQ6IHtcbiAgICAgICAgICAgIHR5cGU6IE9iamVjdCxcbiAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWRcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgc2VsZWN0ZWQ6IHtcbiAgICAgICAgICAgIHR5cGU6IEFycmF5LFxuICAgICAgICAgICAgdmFsdWU6IFtdLFxuICAgICAgICAgICAgbm90aWZ5OiB0cnVlXG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGF2YWlsYWJsZToge1xuICAgICAgICAgICAgdHlwZTogQXJyYXksXG4gICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHJldHVybiBfLm1hcChfLnJhbmdlKDAsIDIwMCksIGZ1bmN0aW9uKHgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgaWQ6IHgsXG4gICAgICAgICAgICAgICAgICBsYWJlbDogJycgKyB4XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGRiOiB7XG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXG4gICAgICAgICAgfSxcblxuICAgICAgICAgIHNlbGVjdGlvbkxpc3RlbmVyOiB7XG4gICAgICAgICAgICB0eXBlOiBPYmplY3QsXG4gICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXG4gICAgICAgICAgfSxcblxuICAgICAgICAgIG1pbkV4cGFuZDoge1xuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgICAgICAgdmFsdWU6IDFcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXR0YWNoZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBpbnB1dEl0ZW0gPSB0aGlzLiQuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3BhcGVyLWlucHV0Jyk7XG5cbiAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoaW5wdXRJdGVtKSkge1xuICAgICAgICAgICAgdGhpcy5fcGFwZXJJbnB1dCA9IGlucHV0SXRlbTtcbiAgICAgICAgICAgIHRoaXMubGlzdGVuKHRoaXMuX3BhcGVySW5wdXQsICdrZXl1cCcsICdvbklucHV0Q2hhbmdlJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGFkZFRvU2VsZWN0aW9uOiBmdW5jdGlvbihuZXdJdGVtKSB7XG4gICAgICAgICAgY29uc29sZS50cmFjZSgnYWRkaW5nIHRvIHNlbGVjdGlvbihmb3I9JXMpOiAlcywgJW8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3IsIG5ld0l0ZW0ubGFiZWwsIHRoaXMuc2VsZWN0ZWQpO1xuICAgICAgICAgIHRoaXMucHVzaCgnc2VsZWN0ZWQnLCBuZXdJdGVtKTtcbiAgICAgICAgICB0aGlzLl9wYXBlcklucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQodGhpcy5zZWxlY3Rpb25MaXN0ZW5lcikpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYWxsaW5nIG9uU2VsZWN0OicsIHRoaXMuc2VsZWN0aW9uTGlzdGVuZXIpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25MaXN0ZW5lci5vblNlbGVjdChuZXdJdGVtKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlRnJvbVNlbGVjdGlvbjogZnVuY3Rpb24oaXRlbVRvUmVtb3ZlKSB7XG5cbiAgICAgICAgICBjb25zb2xlLmluZm8oJ3JlbW92aW5nICVzIGZyb20gJW8nLCBpdGVtVG9SZW1vdmUubGFiZWwsIF8ubWFwKHRoaXMuc2VsZWN0ZWQsICdsYWJlbCcpKTtcblxuICAgICAgICAgIHZhciBpZHggPSBfLmluZGV4T2YodGhpcy5zZWxlY3RlZCwgaXRlbVRvUmVtb3ZlKTtcbiAgICAgICAgICBjb25zb2xlLmluZm8oJ3JlbW92aW5nIGl0ZW0gYXQgaWR4OiAnLCBpZHgpO1xuICAgICAgICAgIGlmIChfLmd0KGlkeCwgLTEpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmluZm8oJ3JlbW92ZWQgaXRlbSBmcm9tIGxpc3Q6ICcsIHRoaXMuc3BsaWNlKCdzZWxlY3RlZCcsIGlkeCwgMSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ2l0ZW0gJW8gbm90IGZvdW5kIGluIGxpc3QgJW8nLCBpdGVtVG9SZW1vdmUsIHRoaXMuc2VsZWN0ZWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvbklucHV0Q2hhbmdlOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChldmVudC50YXJnZXQpKSB7XG4gICAgICAgICAgICB2YXIgdmFsID0gXy50b0xvd2VyKGV2ZW50LnRhcmdldC52YWx1ZSk7XG4gICAgICAgICAgICB2YXIgbWluID0gdGhpcy5taW5FeHBhbmQ7XG5cbiAgICAgICAgICAgIHZhciBpbnB1dExlbmd0aEdURSA9IGZ1bmN0aW9uKGlucHV0LCBtaW4sIGRlYnVnKSB7XG4gICAgICAgICAgICAgIHZhciB0b1JldHVybiA9IF8uZ3RlKF8uc2l6ZShpbnB1dCksIG1pbik7XG4gICAgICAgICAgICAgIGlmIChkZWJ1Zykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUudHJhY2UoJ18uZ3RlKF8uc2l6ZSglcyksICVzKTogJXMnLCBpbnB1dCwgbWluLCB0b1JldHVybik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIHRvUmV0dXJuO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGlzQ3RybFNwYWNlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICB2YXIgS0VZX0NPREVfU1BBQ0UgPSAzMjtcbiAgICAgICAgICAgICAgcmV0dXJuIGUuY3RybEtleSAmJiBfLmlzRXF1YWwoZS5rZXlDb2RlLCBLRVlfQ09ERV9TUEFDRSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZmlsdGVyZWRJdGVtcyA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24sIGZpbHRlcikge1xuICAgICAgICAgICAgICByZXR1cm4gXy5maWx0ZXIoY29sbGVjdGlvbiwgZnVuY3Rpb24oeCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfLmluY2x1ZGVzKF8udG9Mb3dlcih4LmxhYmVsKSwgZmlsdGVyKTtcbiAgICAgICAgICAgICAgICAvL3JldHVybiBfLnN0YXJ0c1dpdGgoXy50b0xvd2VyKHgubGFiZWwpLCBmaWx0ZXIpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChpbnB1dExlbmd0aEdURSh2YWwsIG1pbikpIHtcbiAgICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb24gPSBfLnVuaXFCeShhcHAuZGJbdGhpcy5kYl0sICdsYWJlbCcpO1xuICAgICAgICAgICAgICB0aGlzLiQuYWNkcm9wZG93bi5pdGVtcyA9IGZpbHRlcmVkSXRlbXMoY29sbGVjdGlvbiwgdmFsKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDdHJsU3BhY2UoZXZlbnQpKSB7XG4gICAgICAgICAgICAgIHRoaXMuJC5hY2Ryb3Bkb3duLml0ZW1zID0gXy5zb3J0QnkoXy51bmlxQnkoYXBwLmRiW3RoaXMuZGJdLCAnbGFiZWwnKSwgJ2xhYmVsJykgO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy90aGlzLiQuYWNvdmVybGF5Lml0ZW1zID0gW107XG4gICAgICAgICAgICAgIGNvbnNvbGUud2FybignaW5wdXQgdmFsdWUgbGVzcyB0aGFuICVzIGNoYXJzJywgbWluKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgeyBjb25zb2xlLndhcm4oJ25vdCByZXNwb25kaW5nIHRvIGlucHV0Jyk7IH1cbiAgICAgICAgfSxcblxuICAgICAgICBhZGRBdXRvY29tcGxldGVJdGVtOiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgaWYgKF8uaXNFcXVhbCh0aGlzLmZvciwgZS5kZXRhaWwuZm9yKSkge1xuICAgICAgICAgICAgY29uc29sZS50cmFjZSgnaXJvbi1zaWduYWw6IHJlcXVlc3QgdG8gYWRkIGl0ZW06ICcsIGUpO1xuICAgICAgICAgICAgdGhpcy5hZGRUb1NlbGVjdGlvbihlLmRldGFpbC5pdGVtKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlQXV0b2NvbXBsZXRlSXRlbTogZnVuY3Rpb24oZSkge1xuICAgICAgICAgIGlmIChfLmlzRXF1YWwodGhpcy5mb3IsIGUuZGV0YWlsLmZvcikpIHtcbiAgICAgICAgICAgIGNvbnNvbGUudHJhY2UoJ2lyb24tc2lnbmFsOiByZXF1ZXN0IHRvIHJlbW92ZSBpdGVtOiAnLCBlKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRnJvbVNlbGVjdGlvbihlLmRldGFpbC5pdGVtKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
