'use strict';

(function () {
  Polymer({
    is: 'aca-article-dialog',
    properties: {
      heading: {
        type: String,
        value: 'Heading not set'
      },
      item: {
        type: Object,
        value: undefined,
        notify: true,
        observer: 'itemChanged'
      },
      images: {
        type: Array,
        value: []
      },
      tags: {
        type: Array,
        value: []
      },
      _showOrHideMediaText: {
        type: String,
        value: 'Show'
      },
      _showOrHideTagsText: {
        type: String,
        value: 'Show'
      },
      _infoUrl: {
        type: String,
        value: ''
      },
      _lookupResponse: {
        type: Object,
        value: undefined
      },
      _lastError: {
        type: Object,
        value: undefined,
        notify: true
      }
    },

    displayArticle: function displayArticle(newItem) {
      console.log('displaying article: ', newItem);
      this.item = newItem;
      this.$.detailsDialog.open();
    },

    itemChanged: function itemChanged(newValue) {
      console.info('change detected: ', newValue);

      //this._updateMetaData(newValue);

      this.heading = S(newValue.article.label ? newValue.article.label : newValue.article.headlineSummary).stripTags().s;

      this.author = S(newValue.article.author).isEmpty() ? 'Unknown Author' : newValue.article.author;
      this.publishDate = new Date(newValue.article.publishDate).toDateString();
      this.titleString = _.isEmpty(newValue.metaData.titleName) ? 'Unknown Title' : newValue.metaData.titleName;
      this.$.htmlContent.innerHTML = newValue.article.articleHTML;

      this.hasImages = imgutils.hasImages(newValue.article);
      if (this.hasImages) {
        var mediaItems = imgutils.mediaItems(newValue.article, 'Image');
        var newImages = [];
        mediaItems.forEach(function (mediaItem) {
          var newImg = _.head(mediaItem.references);
          if (newImg) {
            newImages.push(newImg);
          }
        });
        this.images = newImages;
      } else {
        this.images = [];
      }

      this.hasTags = _.isArray(newValue.article.tags) && newValue.article.tags.length > 0;
      this.tags = this.hasTags ? newValue.article.tags : [];
      console.info('hasTags: ', this.hasTags);
    },

    toggleMedia: function toggleMedia() {
      console.log('toggle collapse: ', this.$.collapse);

      this.$.collapse.toggle();

      this._showOrHideMediaText = this.$.collapse.opened ? 'hide' : 'show';
    },

    toggleTags: function toggleTags() {
      this.$.tagCollapse.toggle();
      this._showOrHideTagsText = this.$.tagCollapse.opened ? 'hide' : 'show';
    },

    _hideDownload: function _hideDownload() {
      return app.config.standalone !== true;
    },

    _imgThumbStyle: function _imgThumbStyle(image) {
      return imgutils.computeThumbDims(image, 200, 'style');
    },

    _imgThumbUrl: function _imgThumbUrl(image) {
      return imgutils.irsThumb(app.config, imgutils.computeThumbDims(image, 200, 'src'), image.imageURL);
    },

    _irsDownload: function _irsDownload(image) {
      return imgutils.irsDownload(app.config, image.imageURL);
    },

    _closeDialog: function _closeDialog() {
      this.$.detailsDialog.close();
    },

    fromContentKey: function fromContentKey(contentKey) {
      // populate fields from content lookup.

      console.debug('populating article from contentKey: ', contentKey);

      var config = {
        contentKey: contentKey,
        datasetKey: 'forsearch',
        type: 'content'
      };

      this.infoUrl = app.multiValueUrl(app.bootstrap.baseLookupTemplate, config);

      console.info('lodash infoUrl: ', this.infoUrl);

      this.metaResponse = { meta: { data: 'Loading...' } };
      this.$.metaAjax.generateRequest();

      this.displayArticle({});
    },

    _updateMetaData: function _updateMetaData(newArticle) {
      console.info('newArticle: ', newArticle);

      var config = {
        contentKey: newArticle.metaData.contentKey,
        datasetKey: 'forsearch',
        type: 'content'
      };

      this.infoUrl = app.multiValueUrl(app.bootstrap.baseLookupTemplate, config);
      console.info('underscore infoUrl: ', this.infoUrl);

      this.metaResponse = { meta: { data: 'Loading...' } };
      this.$.metaAjax.generateRequest();
    }

  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVsZW1lbnRzL2FjYS1hcnRpY2xlLWxpc3QvYWNhLWFydGljbGUtZGlhbG9nLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBQyxZQUFXO0FBQ04sVUFBUTtBQUNOLFFBQUksb0JBREU7QUFFTixnQkFBWTtBQUNWLGVBQVM7QUFDUCxjQUFNLE1BREM7QUFFUCxlQUFPO0FBRkEsT0FEQztBQUtWLFlBQU07QUFDSixjQUFNLE1BREY7QUFFSixlQUFPLFNBRkg7QUFHSixnQkFBUSxJQUhKO0FBSUosa0JBQVU7QUFKTixPQUxJO0FBV1YsY0FBUTtBQUNOLGNBQU0sS0FEQTtBQUVOLGVBQU87QUFGRCxPQVhFO0FBZVYsWUFBTTtBQUNKLGNBQU0sS0FERjtBQUVKLGVBQU87QUFGSCxPQWZJO0FBbUJWLDRCQUFzQjtBQUNwQixjQUFNLE1BRGM7QUFFcEIsZUFBTztBQUZhLE9BbkJaO0FBdUJWLDJCQUFxQjtBQUNuQixjQUFNLE1BRGE7QUFFbkIsZUFBTztBQUZZLE9BdkJYO0FBMkJWLGdCQUFVO0FBQ1IsY0FBTSxNQURFO0FBRVIsZUFBTztBQUZDLE9BM0JBO0FBK0JWLHVCQUFpQjtBQUNmLGNBQU0sTUFEUztBQUVmLGVBQU87QUFGUSxPQS9CUDtBQW1DVixrQkFBWTtBQUNWLGNBQU0sTUFESTtBQUVWLGVBQU8sU0FGRztBQUdWLGdCQUFRO0FBSEU7QUFuQ0YsS0FGTjs7QUE0Q04sb0JBQWdCLHdCQUFTLE9BQVQsRUFBa0I7QUFDaEMsY0FBUSxHQUFSLENBQVksc0JBQVosRUFBb0MsT0FBcEM7QUFDQSxXQUFLLElBQUwsR0FBWSxPQUFaO0FBQ0EsV0FBSyxDQUFMLENBQU8sYUFBUCxDQUFxQixJQUFyQjtBQUNELEtBaERLOztBQWtETixpQkFBYSxxQkFBUyxRQUFULEVBQW1CO0FBQzlCLGNBQVEsSUFBUixDQUFhLG1CQUFiLEVBQWtDLFFBQWxDOztBQUVBOztBQUVBLFdBQUssT0FBTCxHQUFlLEVBQUUsU0FBUyxPQUFULENBQWlCLEtBQWpCLEdBQXlCLFNBQVMsT0FBVCxDQUFpQixLQUExQyxHQUNFLFNBQVMsT0FBVCxDQUFpQixlQURyQixFQUNzQyxTQUR0QyxHQUNrRCxDQURqRTs7QUFHQSxXQUFLLE1BQUwsR0FBYyxFQUFFLFNBQVMsT0FBVCxDQUFpQixNQUFuQixFQUEyQixPQUEzQixLQUF1QyxnQkFBdkMsR0FDVixTQUFTLE9BQVQsQ0FBaUIsTUFEckI7QUFFQSxXQUFLLFdBQUwsR0FBbUIsSUFBSSxJQUFKLENBQVMsU0FBUyxPQUFULENBQWlCLFdBQTFCLEVBQXVDLFlBQXZDLEVBQW5CO0FBQ0EsV0FBSyxXQUFMLEdBQW1CLEVBQUUsT0FBRixDQUFVLFNBQVMsUUFBVCxDQUFrQixTQUE1QixJQUNmLGVBRGUsR0FFZixTQUFTLFFBQVQsQ0FBa0IsU0FGdEI7QUFHQSxXQUFLLENBQUwsQ0FBTyxXQUFQLENBQW1CLFNBQW5CLEdBQStCLFNBQVMsT0FBVCxDQUFpQixXQUFoRDs7QUFFQSxXQUFLLFNBQUwsR0FBaUIsU0FBUyxTQUFULENBQW1CLFNBQVMsT0FBNUIsQ0FBakI7QUFDQSxVQUFJLEtBQUssU0FBVCxFQUFvQjtBQUNsQixZQUFJLGFBQWEsU0FBUyxVQUFULENBQW9CLFNBQVMsT0FBN0IsRUFBc0MsT0FBdEMsQ0FBakI7QUFDQSxZQUFJLFlBQVksRUFBaEI7QUFDQSxtQkFBVyxPQUFYLENBQW1CLFVBQVMsU0FBVCxFQUFvQjtBQUNyQyxjQUFJLFNBQVMsRUFBRSxJQUFGLENBQU8sVUFBVSxVQUFqQixDQUFiO0FBQ0EsY0FBSSxNQUFKLEVBQVk7QUFDVixzQkFBVSxJQUFWLENBQWUsTUFBZjtBQUNEO0FBQ0YsU0FMRDtBQU1BLGFBQUssTUFBTCxHQUFjLFNBQWQ7QUFDRCxPQVZELE1BVU87QUFDTCxhQUFLLE1BQUwsR0FBYyxFQUFkO0FBQ0Q7O0FBRUQsV0FBSyxPQUFMLEdBQWUsRUFBRSxPQUFGLENBQVUsU0FBUyxPQUFULENBQWlCLElBQTNCLEtBQW9DLFNBQVMsT0FBVCxDQUFpQixJQUFqQixDQUFzQixNQUF0QixHQUErQixDQUFsRjtBQUNBLFdBQUssSUFBTCxHQUFZLEtBQUssT0FBTCxHQUFlLFNBQVMsT0FBVCxDQUFpQixJQUFoQyxHQUF1QyxFQUFuRDtBQUNBLGNBQVEsSUFBUixDQUFhLFdBQWIsRUFBMEIsS0FBSyxPQUEvQjtBQUNELEtBcEZLOztBQXNGTixpQkFBYSx1QkFBVztBQUN0QixjQUFRLEdBQVIsQ0FBWSxtQkFBWixFQUFpQyxLQUFLLENBQUwsQ0FBTyxRQUF4Qzs7QUFFQSxXQUFLLENBQUwsQ0FBTyxRQUFQLENBQWdCLE1BQWhCOztBQUVBLFdBQUssb0JBQUwsR0FBNEIsS0FBSyxDQUFMLENBQU8sUUFBUCxDQUFnQixNQUFoQixHQUF5QixNQUF6QixHQUFrQyxNQUE5RDtBQUNELEtBNUZLOztBQThGTixnQkFBWSxzQkFBVztBQUNyQixXQUFLLENBQUwsQ0FBTyxXQUFQLENBQW1CLE1BQW5CO0FBQ0EsV0FBSyxtQkFBTCxHQUEyQixLQUFLLENBQUwsQ0FBTyxXQUFQLENBQW1CLE1BQW5CLEdBQTRCLE1BQTVCLEdBQXFDLE1BQWhFO0FBQ0QsS0FqR0s7O0FBbUdOLG1CQUFlLHlCQUFXO0FBQ3hCLGFBQU8sSUFBSSxNQUFKLENBQVcsVUFBWCxLQUEwQixJQUFqQztBQUNELEtBckdLOztBQXVHTixvQkFBZ0Isd0JBQVMsS0FBVCxFQUFnQjtBQUM5QixhQUFPLFNBQVMsZ0JBQVQsQ0FBMEIsS0FBMUIsRUFBaUMsR0FBakMsRUFBc0MsT0FBdEMsQ0FBUDtBQUNELEtBekdLOztBQTJHTixrQkFBYyxzQkFBUyxLQUFULEVBQWdCO0FBQzVCLGFBQU8sU0FBUyxRQUFULENBQ0wsSUFBSSxNQURDLEVBRUwsU0FBUyxnQkFBVCxDQUEwQixLQUExQixFQUFpQyxHQUFqQyxFQUFzQyxLQUF0QyxDQUZLLEVBR0wsTUFBTSxRQUhELENBQVA7QUFLRCxLQWpISzs7QUFtSE4sa0JBQWMsc0JBQVMsS0FBVCxFQUFnQjtBQUM1QixhQUFPLFNBQVMsV0FBVCxDQUFxQixJQUFJLE1BQXpCLEVBQWlDLE1BQU0sUUFBdkMsQ0FBUDtBQUNELEtBckhLOztBQXVITixrQkFBYyx3QkFBVztBQUN2QixXQUFLLENBQUwsQ0FBTyxhQUFQLENBQXFCLEtBQXJCO0FBQ0QsS0F6SEs7O0FBMkhOLG9CQUFnQix3QkFBUyxVQUFULEVBQXFCO0FBQ25DOztBQUVBLGNBQVEsS0FBUixDQUFjLHNDQUFkLEVBQXNELFVBQXREOztBQUVBLFVBQUksU0FBUztBQUNYLG9CQUFZLFVBREQ7QUFFWCxvQkFBWSxXQUZEO0FBR1gsY0FBTTtBQUhLLE9BQWI7O0FBTUEsV0FBSyxPQUFMLEdBQWUsSUFBSSxhQUFKLENBQWtCLElBQUksU0FBSixDQUFjLGtCQUFoQyxFQUFvRCxNQUFwRCxDQUFmOztBQUVBLGNBQVEsSUFBUixDQUFhLGtCQUFiLEVBQWlDLEtBQUssT0FBdEM7O0FBRUEsV0FBSyxZQUFMLEdBQW9CLEVBQUMsTUFBTSxFQUFDLE1BQU0sWUFBUCxFQUFQLEVBQXBCO0FBQ0EsV0FBSyxDQUFMLENBQU8sUUFBUCxDQUFnQixlQUFoQjs7QUFFQSxXQUFLLGNBQUwsQ0FBb0IsRUFBcEI7QUFDRCxLQTlJSzs7QUFnSk4scUJBQWlCLHlCQUFTLFVBQVQsRUFBcUI7QUFDcEMsY0FBUSxJQUFSLENBQWEsY0FBYixFQUE2QixVQUE3Qjs7QUFFQSxVQUFJLFNBQVM7QUFDWCxvQkFBWSxXQUFXLFFBQVgsQ0FBb0IsVUFEckI7QUFFWCxvQkFBWSxXQUZEO0FBR1gsY0FBTTtBQUhLLE9BQWI7O0FBTUEsV0FBSyxPQUFMLEdBQWUsSUFBSSxhQUFKLENBQWtCLElBQUksU0FBSixDQUFjLGtCQUFoQyxFQUFvRCxNQUFwRCxDQUFmO0FBQ0EsY0FBUSxJQUFSLENBQWEsc0JBQWIsRUFBcUMsS0FBSyxPQUExQzs7QUFFQSxXQUFLLFlBQUwsR0FBb0IsRUFBQyxNQUFNLEVBQUMsTUFBTSxZQUFQLEVBQVAsRUFBcEI7QUFDQSxXQUFLLENBQUwsQ0FBTyxRQUFQLENBQWdCLGVBQWhCO0FBQ0Q7O0FBOUpLLEdBQVI7QUFpS0QsQ0FsS0wiLCJmaWxlIjoiZWxlbWVudHMvYWNhLWFydGljbGUtbGlzdC9hY2EtYXJ0aWNsZS1kaWFsb2cuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG4gICAgICBQb2x5bWVyKHtcbiAgICAgICAgaXM6ICdhY2EtYXJ0aWNsZS1kaWFsb2cnLFxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgaGVhZGluZzoge1xuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICAgICAgdmFsdWU6ICdIZWFkaW5nIG5vdCBzZXQnXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpdGVtOiB7XG4gICAgICAgICAgICB0eXBlOiBPYmplY3QsXG4gICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgbm90aWZ5OiB0cnVlLFxuICAgICAgICAgICAgb2JzZXJ2ZXI6ICdpdGVtQ2hhbmdlZCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIGltYWdlczoge1xuICAgICAgICAgICAgdHlwZTogQXJyYXksXG4gICAgICAgICAgICB2YWx1ZTogW11cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRhZ3M6IHtcbiAgICAgICAgICAgIHR5cGU6IEFycmF5LFxuICAgICAgICAgICAgdmFsdWU6IFtdXG4gICAgICAgICAgfSxcbiAgICAgICAgICBfc2hvd09ySGlkZU1lZGlhVGV4dDoge1xuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICAgICAgdmFsdWU6ICdTaG93J1xuICAgICAgICAgIH0sXG4gICAgICAgICAgX3Nob3dPckhpZGVUYWdzVGV4dDoge1xuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICAgICAgdmFsdWU6ICdTaG93J1xuICAgICAgICAgIH0sXG4gICAgICAgICAgX2luZm9Vcmw6IHtcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgICAgIHZhbHVlOiAnJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgX2xvb2t1cFJlc3BvbnNlOiB7XG4gICAgICAgICAgICB0eXBlOiBPYmplY3QsXG4gICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXG4gICAgICAgICAgfSxcbiAgICAgICAgICBfbGFzdEVycm9yOiB7XG4gICAgICAgICAgICB0eXBlOiBPYmplY3QsXG4gICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgbm90aWZ5OiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRpc3BsYXlBcnRpY2xlOiBmdW5jdGlvbihuZXdJdGVtKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2Rpc3BsYXlpbmcgYXJ0aWNsZTogJywgbmV3SXRlbSk7XG4gICAgICAgICAgdGhpcy5pdGVtID0gbmV3SXRlbTtcbiAgICAgICAgICB0aGlzLiQuZGV0YWlsc0RpYWxvZy5vcGVuKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXRlbUNoYW5nZWQ6IGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKCdjaGFuZ2UgZGV0ZWN0ZWQ6ICcsIG5ld1ZhbHVlKTtcblxuICAgICAgICAgIC8vdGhpcy5fdXBkYXRlTWV0YURhdGEobmV3VmFsdWUpO1xuXG4gICAgICAgICAgdGhpcy5oZWFkaW5nID0gUyhuZXdWYWx1ZS5hcnRpY2xlLmxhYmVsID8gbmV3VmFsdWUuYXJ0aWNsZS5sYWJlbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBuZXdWYWx1ZS5hcnRpY2xlLmhlYWRsaW5lU3VtbWFyeSkuc3RyaXBUYWdzKCkucztcblxuICAgICAgICAgIHRoaXMuYXV0aG9yID0gUyhuZXdWYWx1ZS5hcnRpY2xlLmF1dGhvcikuaXNFbXB0eSgpID8gJ1Vua25vd24gQXV0aG9yJ1xuICAgICAgICAgICAgOiBuZXdWYWx1ZS5hcnRpY2xlLmF1dGhvcjtcbiAgICAgICAgICB0aGlzLnB1Ymxpc2hEYXRlID0gbmV3IERhdGUobmV3VmFsdWUuYXJ0aWNsZS5wdWJsaXNoRGF0ZSkudG9EYXRlU3RyaW5nKCk7XG4gICAgICAgICAgdGhpcy50aXRsZVN0cmluZyA9IF8uaXNFbXB0eShuZXdWYWx1ZS5tZXRhRGF0YS50aXRsZU5hbWUpID9cbiAgICAgICAgICAgICAgJ1Vua25vd24gVGl0bGUnIDpcbiAgICAgICAgICAgICAgbmV3VmFsdWUubWV0YURhdGEudGl0bGVOYW1lO1xuICAgICAgICAgIHRoaXMuJC5odG1sQ29udGVudC5pbm5lckhUTUwgPSBuZXdWYWx1ZS5hcnRpY2xlLmFydGljbGVIVE1MO1xuXG4gICAgICAgICAgdGhpcy5oYXNJbWFnZXMgPSBpbWd1dGlscy5oYXNJbWFnZXMobmV3VmFsdWUuYXJ0aWNsZSk7XG4gICAgICAgICAgaWYgKHRoaXMuaGFzSW1hZ2VzKSB7XG4gICAgICAgICAgICB2YXIgbWVkaWFJdGVtcyA9IGltZ3V0aWxzLm1lZGlhSXRlbXMobmV3VmFsdWUuYXJ0aWNsZSwgJ0ltYWdlJyk7XG4gICAgICAgICAgICB2YXIgbmV3SW1hZ2VzID0gW107XG4gICAgICAgICAgICBtZWRpYUl0ZW1zLmZvckVhY2goZnVuY3Rpb24obWVkaWFJdGVtKSB7XG4gICAgICAgICAgICAgIHZhciBuZXdJbWcgPSBfLmhlYWQobWVkaWFJdGVtLnJlZmVyZW5jZXMpO1xuICAgICAgICAgICAgICBpZiAobmV3SW1nKSB7XG4gICAgICAgICAgICAgICAgbmV3SW1hZ2VzLnB1c2gobmV3SW1nKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmltYWdlcyA9IG5ld0ltYWdlcztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbWFnZXMgPSBbXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLmhhc1RhZ3MgPSBfLmlzQXJyYXkobmV3VmFsdWUuYXJ0aWNsZS50YWdzKSAmJiBuZXdWYWx1ZS5hcnRpY2xlLnRhZ3MubGVuZ3RoID4gMDtcbiAgICAgICAgICB0aGlzLnRhZ3MgPSB0aGlzLmhhc1RhZ3MgPyBuZXdWYWx1ZS5hcnRpY2xlLnRhZ3MgOiBbXTtcbiAgICAgICAgICBjb25zb2xlLmluZm8oJ2hhc1RhZ3M6ICcsIHRoaXMuaGFzVGFncyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlTWVkaWE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCd0b2dnbGUgY29sbGFwc2U6ICcsIHRoaXMuJC5jb2xsYXBzZSk7XG5cbiAgICAgICAgICB0aGlzLiQuY29sbGFwc2UudG9nZ2xlKCk7XG5cbiAgICAgICAgICB0aGlzLl9zaG93T3JIaWRlTWVkaWFUZXh0ID0gdGhpcy4kLmNvbGxhcHNlLm9wZW5lZCA/ICdoaWRlJyA6ICdzaG93JztcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGVUYWdzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB0aGlzLiQudGFnQ29sbGFwc2UudG9nZ2xlKCk7XG4gICAgICAgICAgdGhpcy5fc2hvd09ySGlkZVRhZ3NUZXh0ID0gdGhpcy4kLnRhZ0NvbGxhcHNlLm9wZW5lZCA/ICdoaWRlJyA6ICdzaG93JztcbiAgICAgICAgfSxcblxuICAgICAgICBfaGlkZURvd25sb2FkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gYXBwLmNvbmZpZy5zdGFuZGFsb25lICE9PSB0cnVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9pbWdUaHVtYlN0eWxlOiBmdW5jdGlvbihpbWFnZSkge1xuICAgICAgICAgIHJldHVybiBpbWd1dGlscy5jb21wdXRlVGh1bWJEaW1zKGltYWdlLCAyMDAsICdzdHlsZScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9pbWdUaHVtYlVybDogZnVuY3Rpb24oaW1hZ2UpIHtcbiAgICAgICAgICByZXR1cm4gaW1ndXRpbHMuaXJzVGh1bWIoXG4gICAgICAgICAgICBhcHAuY29uZmlnLFxuICAgICAgICAgICAgaW1ndXRpbHMuY29tcHV0ZVRodW1iRGltcyhpbWFnZSwgMjAwLCAnc3JjJyksXG4gICAgICAgICAgICBpbWFnZS5pbWFnZVVSTFxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2lyc0Rvd25sb2FkOiBmdW5jdGlvbihpbWFnZSkge1xuICAgICAgICAgIHJldHVybiBpbWd1dGlscy5pcnNEb3dubG9hZChhcHAuY29uZmlnLCBpbWFnZS5pbWFnZVVSTCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2Nsb3NlRGlhbG9nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB0aGlzLiQuZGV0YWlsc0RpYWxvZy5jbG9zZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGZyb21Db250ZW50S2V5OiBmdW5jdGlvbihjb250ZW50S2V5KSB7XG4gICAgICAgICAgLy8gcG9wdWxhdGUgZmllbGRzIGZyb20gY29udGVudCBsb29rdXAuXG5cbiAgICAgICAgICBjb25zb2xlLmRlYnVnKCdwb3B1bGF0aW5nIGFydGljbGUgZnJvbSBjb250ZW50S2V5OiAnLCBjb250ZW50S2V5KTtcblxuICAgICAgICAgIGxldCBjb25maWcgPSB7XG4gICAgICAgICAgICBjb250ZW50S2V5OiBjb250ZW50S2V5LFxuICAgICAgICAgICAgZGF0YXNldEtleTogJ2ZvcnNlYXJjaCcsXG4gICAgICAgICAgICB0eXBlOiAnY29udGVudCdcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgdGhpcy5pbmZvVXJsID0gYXBwLm11bHRpVmFsdWVVcmwoYXBwLmJvb3RzdHJhcC5iYXNlTG9va3VwVGVtcGxhdGUsIGNvbmZpZyk7XG5cbiAgICAgICAgICBjb25zb2xlLmluZm8oJ2xvZGFzaCBpbmZvVXJsOiAnLCB0aGlzLmluZm9VcmwpO1xuXG4gICAgICAgICAgdGhpcy5tZXRhUmVzcG9uc2UgPSB7bWV0YToge2RhdGE6ICdMb2FkaW5nLi4uJ319O1xuICAgICAgICAgIHRoaXMuJC5tZXRhQWpheC5nZW5lcmF0ZVJlcXVlc3QoKTtcblxuICAgICAgICAgIHRoaXMuZGlzcGxheUFydGljbGUoe30pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF91cGRhdGVNZXRhRGF0YTogZnVuY3Rpb24obmV3QXJ0aWNsZSkge1xuICAgICAgICAgIGNvbnNvbGUuaW5mbygnbmV3QXJ0aWNsZTogJywgbmV3QXJ0aWNsZSk7XG5cbiAgICAgICAgICBsZXQgY29uZmlnID0ge1xuICAgICAgICAgICAgY29udGVudEtleTogbmV3QXJ0aWNsZS5tZXRhRGF0YS5jb250ZW50S2V5LFxuICAgICAgICAgICAgZGF0YXNldEtleTogJ2ZvcnNlYXJjaCcsXG4gICAgICAgICAgICB0eXBlOiAnY29udGVudCdcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgdGhpcy5pbmZvVXJsID0gYXBwLm11bHRpVmFsdWVVcmwoYXBwLmJvb3RzdHJhcC5iYXNlTG9va3VwVGVtcGxhdGUsIGNvbmZpZyk7XG4gICAgICAgICAgY29uc29sZS5pbmZvKCd1bmRlcnNjb3JlIGluZm9Vcmw6ICcsIHRoaXMuaW5mb1VybCk7XG5cbiAgICAgICAgICB0aGlzLm1ldGFSZXNwb25zZSA9IHttZXRhOiB7ZGF0YTogJ0xvYWRpbmcuLi4nfX07XG4gICAgICAgICAgdGhpcy4kLm1ldGFBamF4LmdlbmVyYXRlUmVxdWVzdCgpO1xuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
